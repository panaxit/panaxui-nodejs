/**
 * API Frisby tests
 */

var frisby = require('frisby'),
	panaxui = require('../../panaxui'),
	url = 'http://' + panaxui.config.host + ':' + panaxui.config.port;

frisby.create('Login')
	.post(url + '/login', {
		username: panaxui.config.username,
		password: panaxui.config.password
	})
	.expectStatus(200)
	.expectHeaderContains('content-type', 'application/json')
	.expectJSON({
		success: true,
		// data: {
		// 	userId: //ToDo: Special userId verification?
		// }
	})
	.expectJSONTypes({
		success: Boolean,
		data: {
			userId: String
		}
	})
.toss();

frisby.create('Get sitemap when logged in')
	.get(url + '/sitemap')
	.expectStatus(200)
	.expectHeaderContains('content-type', 'application/json')
	.expectJSON({
		success: true
	})
	.expectJSONLength('data', function (val) {
		expect(val).toBeGreaterThan(0);
	})
	.expectJSONTypes({
		success: Boolean,
		data: Array
	})
.toss();

frisby.create('Logout')
	.get(url + '/logout')
	.expectStatus(200)
	.expectHeaderContains('content-type', 'application/json')
	.expectJSON({
		success: true
	})
	.expectJSONTypes({
		success: Boolean
	})
.toss();

//ToDo: frisby.create('Deny sitemap when logged out')